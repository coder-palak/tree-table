!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/material/table"),require("@angular/material/icon"),require("fp-ts/lib/Option"),require("@angular/material"),require("@angular/core"),require("lodash-es"),require("rxjs")):"function"==typeof define&&define.amd?define("ng-material-treetable",["exports","@angular/common","@angular/material/table","@angular/material/icon","fp-ts/lib/Option","@angular/material","@angular/core","lodash-es","rxjs"],t):t(e["ng-material-treetable"]={},e.ng.common,e.ng.material.table,e.ng.material.icon,e.Option,e.ng.material,e.ng.core,e.lodashEs,e.rxjs)}(this,function(e,t,r,n,i,o,a,l,c){"use strict";function s(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)a.push(n.value)}catch(l){o={error:l}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return a}function u(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e}var d=(p.prototype.traverse=function(e,t){this._traverse(e,function(e){return t(e),!0})},p.prototype.searchById=function(e,r){var n,o={};return this._traverse(e,function(t){return t.children.forEach(function(e){o[e.id]=t}),t.id===r&&(n=t),t.id!==r}),n?i.some({id:n.id,value:n.value,children:n.children,pathToRoot:this.buildPath(r,o)}):i.none},p.prototype._traverse=function(e,t){var r=this;t(e)&&e.children.forEach(function(e){return r._traverse(e,t)})},p.prototype.getNodeDepth=function(e,t){return this.searchById(e,t.id).fold(-1,function(e){return e.pathToRoot.length})},p.prototype.flatten=function(e){for(var t=[l.cloneDeep(e)],r=0;r<t.length;r++){var n=t[r];n.children&&t.splice.apply(t,u([t.indexOf(n)+1,0],n.children))}return t},p.prototype.buildPath=function(e,t){for(var r=[],n=e;n;)n=t[n]?(r.push(t[n]),t[n].id):null;return r},p.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],p.ngInjectableDef=a.defineInjectable({factory:function(){return new p},token:p,providedIn:"root"}),p);function p(){}var f=(h.prototype.validateCustomOrder=function(e,t){var r=l.xor(Object.keys(e.value),t);return{valid:l.isEmpty(r),xor:r}},h.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],h.ngInjectableDef=a.defineInjectable({factory:function(){return new h},token:h,providedIn:"root"}),h);function h(){}var v=require("uuid/v4"),m=(y.prototype.toSearchableTree=function(e){var t=l.cloneDeep(e);return this.treeService.traverse(t,function(e){e.id=e.id?e.id:v()}),t},y.prototype.toTreeTableTree=function(e){var t=this,r=l.cloneDeep(e);return this.treeService.traverse(r,function(e){e.depth=t.treeService.getNodeDepth(r,e),e.isExpanded=!0,e.isVisible=!0}),r},y.decorators=[{type:a.Injectable,args:[{providedIn:"root"}]}],y.ctorParameters=function(){return[{type:d}]},y.ngInjectableDef=a.defineInjectable({factory:function(){return new y(a.inject(d))},token:y,providedIn:"root"}),y);function y(e){this.treeService=e}var b={verticalSeparator:!0,highlightRowOnHover:!0,elevation:5};function g(t,r){Object.defineProperty(t,r,{get:function(){throw new Error("Input '"+r+"' is required. Have you forgotten to add ["+r+"] = ... in your template?")},set:function(e){Object.defineProperty(t,r,{value:e,writable:!0,configurable:!0})}})}var w=(I.prototype.ngOnInit=function(){var t=this;this.tree=Array.isArray(this.tree)?this.tree:[this.tree],this.options=this.parseOptions(b);var e=this.validatorService.validateCustomOrder(this.tree[0],this.options.customColumnOrder);if(this.options.customColumnOrder&&!e.valid)throw new Error("\n        Properties "+e.xor.map(function(e){return"'"+e+"'"}).join(", ")+" incorrect or missing in customColumnOrder");this.displayedColumns=this.options.customColumnOrder?this.options.customColumnOrder:this.extractNodeProps(this.tree[0]),this.searchableTree=this.tree.map(function(e){return t.converterService.toSearchableTree(e)});var r=this.searchableTree.map(function(e){return t.converterService.toTreeTableTree(e)});this.treeTable=l.flatMap(r,this.treeService.flatten),this.dataSource=this.generateDataSource()},I.prototype.extractNodeProps=function(t){return Object.keys(t.value).filter(function(e){return"object"!=typeof t.value[e]})},I.prototype.generateDataSource=function(){return new o.MatTableDataSource(this.treeTable.filter(function(e){return e.isVisible}))},I.prototype.formatIndentation=function(e,t){return void 0===t&&(t=5),"&nbsp;".repeat(e.depth*t)},I.prototype.formatElevation=function(){return"mat-elevation-z"+this.options.elevation},I.prototype.onNodeClick=function(e){var r=this;e.isExpanded=!e.isExpanded,this.treeTable.forEach(function(t){t.isVisible=r.searchableTree.every(function(e){return r.treeService.searchById(e,t.id).fold([],function(e){return e.pathToRoot}).every(function(t){return r.treeTable.find(function(e){return e.id===t.id}).isExpanded})})}),this.dataSource=this.generateDataSource(),this.nodeClicked.next(e)},I.prototype.parseOptions=function(e){return l.defaults(this.options,e)},I.decorators=[{type:a.Component,args:[{selector:"ng-treetable, treetable",template:'<table mat-table [dataSource]="dataSource" [ngClass]="formatElevation()">\n\n  <div *ngFor="let column of displayedColumns; first as isFirst;">\n    <ng-container matColumnDef="{{column}}">\n      <th mat-header-cell *matHeaderCellDef [ngClass]="{\'vertical-separator\': options.verticalSeparator}">\n        {{options.capitalisedHeader ? (column | titlecase) : column}}\n      </th>\n      <td mat-cell *matCellDef="let element" [ngClass]="{\'vertical-separator\': options.verticalSeparator}">\n        <div *ngIf="isFirst">\n          <div class="value-cell">\n            <div [innerHTML]="formatIndentation(element)"></div>\n            <mat-icon [ngStyle]="{\'visibility\': element.children.length ? \'visible\' : \'hidden\'}" (click)="onNodeClick(element)">\n              {{element.isExpanded ? \'keyboard_arrow_down\' : \'keyboard_arrow_right\'}}\n            </mat-icon>\n            <div>{{element.value[column]}}</div>\n          </div>\n        </div>\n        <div *ngIf="!isFirst">\n          {{element.value[column]}}\n        </div>\n      </td>\n    </ng-container>\n  </div>\n\n  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>\n  <tr mat-row [ngClass]="{\'highlight-on-hover\': options.highlightRowOnHover}" *matRowDef="let row; columns: displayedColumns;"></tr>\n\n</table>\n',styles:["table{width:100%}.value-cell{display:flex;align-items:center}mat-icon{cursor:pointer}.highlight-on-hover:hover{background-color:#f0f0f5}td[class*=' mat-column']{width:10vw;min-width:10vw;max-width:10vw}.mat-cell,.mat-header-cell{padding:10px}.vertical-separator{border-left:1px solid #f0f0f5}td div{word-break:break-all}"]}]}],I.ctorParameters=function(){return[{type:d},{type:f},{type:m},{type:a.ElementRef}]},I.propDecorators={tree:[{type:a.Input}],options:[{type:a.Input}],nodeClicked:[{type:a.Output}]},function C(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var l=e.length-1;0<=l;l--)(o=e[l])&&(a=(i<3?o(a):3<i?o(t,r,a):o(t,r))||a);return 3<i&&a&&Object.defineProperty(t,r,a),a}([g,function O(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:type",Object)],I.prototype,"tree",void 0),I);function I(e,t,r,n){this.treeService=e,this.validatorService=t,this.converterService=r,this.options={},this.nodeClicked=new c.Subject,"ng-treetable"===n.nativeElement.tagName.toLowerCase()&&console.warn("DEPRECATION WARNING: \n The 'ng-treetable' selector is being deprecated. Please use the new 'treetable' selector")}var S=(j.decorators=[{type:a.NgModule,args:[{declarations:[w],imports:[t.CommonModule,r.MatTableModule,n.MatIconModule],exports:[w]}]}],j);function j(){}e.TreetableModule=S,e.ɵa=w,e.ɵb=g,e.ɵe=m,e.ɵc=d,e.ɵd=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ng-material-treetable.umd.min.js.map